<?php

include_once 'config.php';
include_once 'classes.php';

// Erzeuge benötigte Objekte
$dbconnect = new DBConnection(MYSQL_HOST, MYSQL_BENUTZER, MYSQL_KENNWORT, MYSQL_DATENBANK);
$kneipentest_queries = new KneipenTestQueries($dbconnect);

// Frage GET und POST Variablen ab
$page = isset($_GET["page"]) ? $_GET["page"] : "kneipenliste";
$order_column = isset($_GET["ordercolumn"]) ? $_GET["ordercolumn"] : "name";
$order = isset($_GET["order"]) ? $_GET["order"] : "ASC";
$kneipenart = isset($_POST['kneipenart']) ? $_POST['kneipenart'] : '';
$name = isset($_POST['name']) ? $_POST['name'] : '';
$kneipenartId = isset($_POST['kneipenartId']) ? $_POST['kneipenartId'] : '';
$noteId = isset($_POST['noteId']) ? $_POST['noteId'] : '';
$kommentar = isset($_POST['kommentar']) ? $_POST['kommentar'] : '';
$suchbegriff = isset($_POST['suchbegriff']) ? $_POST['suchbegriff'] : '';
if(empty($suchbegriff)) {
	$suchbegriff = isset($_GET['suchbegriff']) ? $_GET['suchbegriff'] : '';
}

// Füge neuen Datensatz in der Tabelle kneipen_arten ein
if(!empty($kneipenart)) {
	$dbconnect->insert("kt_kneipen_arten", array("bezeichnung" => $kneipenart));
}

// Füge neuen Datensatz in der Tabelle kneipen ein
if(!empty($name) && !empty($kneipenartId) && !empty($noteId)) {
	$dbconnect->insert("kt_kneipen", array("name" => $name, "kneipen_arten_id" => $kneipenartId,
		"noten_id" => $noteId, "kommentar" => $kommentar));
}

// Daten aus Datenbank abfragen
$kneipen_art_db_result = $kneipentest_queries->selectKneipenArten();
$noten_db_result = $kneipentest_queries->selectNoten();
$kneipen_db_result = $kneipentest_queries->selectKneipen($order_column, $order, $suchbegriff);

?>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript">
<!--
/* http://www.alistapart.com/articles/zebratables/ */
function removeClassName (elem, className) {
	elem.className = elem.className.replace(className, "").trim();
}

function addCSSClass (elem, className) {
	removeClassName (elem, className);
	elem.className = (elem.className + " " + className).trim();
}

String.prototype.trim = function() {
	return this.replace( /^\s+|\s+$/, "" );
}

function stripedTable() {
	if (document.getElementById && document.getElementsByTagName) {  
		var allTables = document.getElementsByTagName('table');
		if (!allTables) { return; }

		for (var i = 0; i < allTables.length; i++) {
			if (allTables[i].className.match(/[\w\s ]*scrollTable[\w\s ]*/)) {
				var trs = allTables[i].getElementsByTagName("tr");
				for (var j = 0; j < trs.length; j++) {
					removeClassName(trs[j], 'alternateRow');
					addCSSClass(trs[j], 'normalRow');
				}
				for (var k = 0; k < trs.length; k += 2) {
					removeClassName(trs[k], 'normalRow');
					addCSSClass(trs[k], 'alternateRow');
				}
			}
		}
	}
}

window.onload = function() { stripedTable(); }
-->
</script>

<title>Kneipenübersicht</title>
<link rel="stylesheet" type="text/css" href="../css/standard-style.css">

</head>
<body>

<div id="root">
<div id="centeredContent">

	<!-- Headerbereich -->
	<div id="kopf"></div>

	<!-- Navigation -->
	<div id="links"><span class="textUeberschriften">Navigation</span>
		<ul>
			<li><a href="kneipenEingabe.php?page=kneipenart">Neue Kneipenart</a></li>
			<li><a href="kneipenEingabe.php?page=kneipe">Neue Kneipe</a></li>
			<li><a href="kneipenEingabe.php?page=kneipenliste">Kneipenliste</a></li>
		</ul>
	</div>

	<!-- Hauptseiteninhalt -->
	<div id="inhalt">
		<?php
		// Liefere Inhalt für die Eingabe einer neuen Kneipenart
		if($page == "kneipenart") { 
			echo "<div class='textUeberschriften'>Kneipenarten hinzufügen</div>";
			echo "<br>";
			echo "<br>";
			echo "<div class='center'>";
			echo "<form action='kneipenEingabe.php' method='post'>";
			echo "<b>Kneipenart:</b> <input name='kneipenart' type='text' />";
			echo "<input type='submit' value='hinzufügen' />";
			echo "</form><br>";
			echo "</div>";
		}

		// Liefere Inhalt für die Eingabe einer neuen Kneipe
		if($page == "kneipe") { 
			echo "<div class='textUeberschriften'>Kneipen hinzufügen</div>";
			echo "<br>";
			echo "<br>";
			echo "<form action='kneipenEingabe.php' method='post'>";
			echo "<table border='0'>";
			echo "<tr>";
			echo "<td><b>Name:</b></td><td><input name='name' type='text' /></td>";
			echo "</tr><tr>";
			echo "<td><b>Kneipenart:</b></td>";
			echo "<td><select name='kneipenartId'>";
			while($row = mysql_fetch_array($kneipen_art_db_result)) {
				echo "<option value='" . $row["id"] . "'>" . $row["bezeichnung"] . "</option>";
			}
			echo "</select></td>";
			echo "</tr><tr>";
			echo "<td><b>Note:</b></td>";
			echo "<td><select name='noteId'>";
			while($row = mysql_fetch_array($noten_db_result)) {
				echo "<option value='" . $row["id"] . "'>" . $row["note"] . "</option>";
			}
			echo "</select></td>";
			echo "</tr><tr>";
			echo "<td colspan='2'><b>Kommentar:</b><br>";
			echo "<textarea name='kommentar' rows='5' cols='50'></textarea></td>";
			echo "</tr><tr>";
			echo "<td colspan='2'><input type='submit' value='hinzufügen' /></td>";
			echo "</tr>";
			echo "</table>";
			echo "</form>";
		}

		// Liefere Inhalt für Auflister aller Kneipen in der Datenbank
		if($page == "kneipenliste") {
			echo "<div class='textUeberschriften'>Kneipenübersicht</div>";
			echo "<div id='tableContainer' class='tableContainer'>";
			echo "<table border='1px' cellpadding='0' cellspacing='0' width='100%' height='30px' class='scrollTable'>";
			echo "<thead class='fixedHeader'>";
			echo "<tr>";
			if($order_column == "name" && $order == "ASC") {
				echo "<th><a href='kneipenEingabe.php?suchbegriff=" . $suchbegriff . "&ordercolumn=name&order=DESC'>Name</a></th>";
			} else {
				echo "<th><a href='kneipenEingabe.php?suchbegriff=" . $suchbegriff . "&ordercolumn=name&order=ASC'>Name</a></th>";
			}
			if($order_column == "bezeichnung" && $order == "ASC") {
				echo "<th><a href='kneipenEingabe.php?suchbegriff=" . $suchbegriff . "&ordercolumn=bezeichnung&order=DESC'>Art</a></th>";
			} else {
				echo "<th><a href='kneipenEingabe.php?suchbegriff=" . $suchbegriff . "&ordercolumn=bezeichnung&order=ASC'>Art</a></th>";
			}
			if($order_column == "note" && $order == "ASC") {
				echo "<th><a href='kneipenEingabe.php?suchbegriff=" . $suchbegriff . "&ordercolumn=note&order=DESC'>Note</a></th>";
			} else {
				echo "<th><a href='kneipenEingabe.php?suchbegriff=" . $suchbegriff . "&ordercolumn=note&order=ASC'>Note</a></th>";
			}
			if($order_column == "kommentar" && $order == "ASC") {
				echo "<th><a href='kneipenEingabe.php?suchbegriff=" . $suchbegriff . "&ordercolumn=kommentar&order=DESC'>Kommentar</a></th>";
			} else {
				echo "<th><a href='kneipenEingabe.php?suchbegriff=" . $suchbegriff . "&ordercolumn=kommentar&order=ASC'>Kommentar</a></th>";
			}
			echo "</tr>";
			echo "</thead>";
			echo "<tbody class='scrollContent'>";
			while ($data = mysql_fetch_array($kneipen_db_result)) {
				echo "<tr>";
				echo "<td>" . $data[0] . "</td><td>" . $data[1] . "</td><td>" . $data[2] . "</td><td>" . $data[3];
				echo "</tr>";
			}
			echo "</tbody>";
			echo "</table>";
			echo "</div>";
			
			echo "<br>";
			echo "<div class='center'>";
			echo "<form action='kneipenEingabe.php' method='post'>";
			echo "<b>Suchbegriff:</b> <input name='suchbegriff' type='text' value='" . $suchbegriff . "' />";
			echo "<input type='submit' value='aktualisieren' />";
			echo "</form><br>";
			echo "</div>";
			
			$kneipentest_queries->__destruct();
			$dbconnect->__destruct();
		}
		?>

	</div>
		
	<!-- Informationsbereich -->
	<div id="rechts"><span class="textUeberschriften">Hinweis</span><br>
		<img alt="warning" src="../../resources/graphics/warning_icon.png"><br />
		Diese Seite wurde für den Firefox erstellt.<br />
		In anderen Browsern kann es zu Anzeigefehlern kommen!
	</div>

	<!-- Footerbereich -->
	<div id="fuss"><span class="textUeberschriften">Erstellt von Thomas Gattinger</span></div>

</div>
</div>

</body>
</html>